{% load static %}
<!DOCTYPE html>
<html lang="en" data-bs-theme="{% block theme %}dark{% endblock %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ page_title|default:"WrestlingDB" }}{% endblock %} - WrestlingDB</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}{{ page_description|default:'The Open Wrestling Database - the most complete free metadata source for professional wrestling from inception to date.' }}{% endblock %}">
    <meta name="keywords" content="wrestling, WWE, AEW, pro wrestling, database, wrestlers, matches, events">
    <meta name="author" content="WrestlingDB">

    <!-- Open Graph -->
    <meta property="og:title" content="{% block og_title %}{{ page_title|default:'WrestlingDB' }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ page_description|default:'The Open Wrestling Database for fans and developers.' }}{% endblock %}">
    <meta property="og:url" content="{% block og_url %}https://wrestlingdb.org{{ request.path }}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="WrestlingDB">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ page_title|default:'WrestlingDB' }}">
    <meta name="twitter:description" content="{{ page_description|default:'The Open Wrestling Database for fans and developers.' }}">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <!-- Custom Styles -->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">

    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Navigation - TMDB Style -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top" role="navigation" aria-label="Main navigation">
            <div class="container">
                <a class="navbar-brand" href="{% url 'index' %}">
                    <span class="brand-logo">W</span>
                    <span class="brand-text">WrestlingDB</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarContent">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Wrestlers
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'wrestlers' %}">Popular</a></li>
                                <li><a class="dropdown-item" href="{% url 'wrestlers' %}">All Wrestlers</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Events
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'events' %}">All Events</a></li>
                                <li><a class="dropdown-item" href="{% url 'matches' %}">Matches</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Promotions
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'promotions' %}">All Promotions</a></li>
                                <li><a class="dropdown-item" href="{% url 'titles' %}">Championships</a></li>
                                <li><a class="dropdown-item" href="{% url 'venues' %}">Venues</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                More
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'games' %}">Video Games</a></li>
                                <li><a class="dropdown-item" href="{% url 'podcasts' %}">Podcasts</a></li>
                                <li><a class="dropdown-item" href="{% url 'books' %}">Books</a></li>
                                <li><a class="dropdown-item" href="{% url 'specials' %}">Documentaries</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'account' %}">API</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item">
                            <button onclick="toggleDarkMode()" class="btn btn-link nav-link p-1" aria-label="Toggle dark mode">
                                <span id="theme-icon" class="theme-toggle-icon"></span>
                            </button>
                        </li>
                        {% if user.is_authenticated %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle user-avatar" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="avatar-circle">{{ user.username|slice:":1"|upper }}</span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="{% url 'account' %}">Account</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{% url 'logout' %}">Logout</a></li>
                                </ul>
                            </li>
                        {% else %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'login' %}">Login</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link btn-join" href="{% url 'signup' %}">Join WrestlingDB</a>
                            </li>
                        {% endif %}
                        <li class="nav-item search-toggle ms-2">
                            <button class="btn btn-link nav-link p-1" onclick="toggleSearch()" aria-label="Search">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Search Bar (Hidden by default, TMDB style) -->
        <div class="search-bar-container" id="searchBar" style="display: none;">
            <div class="container">
                <form action="{% url 'wrestlers' %}" method="get" class="search-form">
                    <input type="text" name="q" class="search-input" placeholder="Search for a wrestler, event, promotion..." autocomplete="off">
                    <button type="submit" class="search-submit">Search</button>
                </form>
            </div>
        </div>
    </header>

    <!-- Flash Messages -->
    {% if messages %}
    <div class="container mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content -->
    <main id="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer - TMDB Style -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="{% url 'index' %}">
                        <span class="brand-logo-lg">W</span>
                    </a>
                </div>
                <div class="footer-nav">
                    <div class="footer-section">
                        <h4>The Basics</h4>
                        <ul>
                            <li><a href="{% url 'index' %}">About WrestlingDB</a></li>
                            <li><a href="{% url 'account' %}">API</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Get Involved</h4>
                        <ul>
                            <li><a href="https://github.com/wrestlingdb" target="_blank" rel="noopener">Contribution Guide</a></li>
                            <li><a href="{% url 'signup' %}">Add New Content</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Community</h4>
                        <ul>
                            <li><a href="https://github.com/wrestlingdb" target="_blank" rel="noopener">GitHub</a></li>
                            <li><a href="#">Discord</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p id="random-quote" class="quote"></p>
                <p class="copyright">&copy; {% now "Y" %} WrestlingDB. The Open Wrestling Database.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- Scripts -->
    <script>
        // Wrestling quotes
        const quotes = [
            "And that's the bottom line, 'cause Stone Cold said so!",
            "If ya smell what The Rock is cookin'!",
            "Rest... in... peace.",
            "To be the man, you gotta beat the man! Wooo!",
            "Whatcha gonna do when Hulkamania runs wild on you?!",
            "Yes! Yes! Yes!",
            "It doesn't matter what you think!",
            "Austin 3:16 says I just whipped your ass!"
        ];

        const quoteEl = document.getElementById('random-quote');
        if (quoteEl) {
            quoteEl.innerText = '"' + quotes[Math.floor(Math.random() * quotes.length)] + '"';
        }

        // Dark mode toggle
        function toggleDarkMode() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Search toggle
        function toggleSearch() {
            const searchBar = document.getElementById('searchBar');
            if (searchBar.style.display === 'none') {
                searchBar.style.display = 'block';
                searchBar.querySelector('input').focus();
            } else {
                searchBar.style.display = 'none';
            }
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-bs-theme', savedTheme);
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
